<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple To-Do List</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        ul { list-style: none; padding: 0; }
        li { margin-bottom: 0.5em; }
        .task-item { display: flex; align-items: center; }
        .task-text { margin-right: 1em; }
        /* Add more styling as desired */
    </style>
</head>
<body>
    <h1>My To-Do List</h1>

    <!-- Form to Add New Tasks (we'll make this work later) -->
    <h2>Add New Task</h2>
    <form action="/add" method="post">
        <input type="text" name="task" required>
        <button type="submit">Add Task</button>
    </form>

    <!-- List of Tasks (we'll populate this later) -->
    <h2>Tasks</h2>
    <ul>
        {% for task in tasks %}
            <li class="task-item">
                <span class="task-text">{{ task }}</span>
                <button class="ask-ai-btn" data-task-text="{{ task }}" style="margin-left: 10px;">Ask AI</button>
                <!-- Add buttons for complete/delete later if desired -->
            </li>
        {% else %}
            <li>No tasks yet!</li>
        {% endfor %}
    </ul>
<!-- <<< PASTE THIS CODE BLOCK BEFORE </body> >>> -->

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Select all "Ask AI" buttons
        const aiButtons = document.querySelectorAll('.ask-ai-btn');

        aiButtons.forEach(button => {
            button.addEventListener('click', async () => {
                const taskText = button.dataset.taskText; // Get task text from data attribute
                button.disabled = true; // Disable button while processing
                button.textContent = 'Asking AI...'; // Provide feedback

                try {
                    const response = await fetch('/ask-ai', { // Send request to our Flask route
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ task_text: taskText }) // Send task text as JSON
                    });

                    const result = await response.json(); // Parse JSON response from Flask

                    if (response.ok) {
                        // Success! Display the details (simple alert for now)
                        alert(`AI Details for "${taskText}":\n\n${result.details}`);
                    } else {
                        // Handle errors reported by the Flask backend
                        alert(`Error fetching AI details: ${result.error || 'Unknown server error'}`);
                    }
                } catch (error) {
                    // Handle network errors or issues reaching the server
                    console.error('Network or fetch error:', error);
                    alert('Failed to contact the AI service. Check the console for details.');
                } finally {
                    // Re-enable button and restore text
                    button.disabled = false;
                    // Restore original text more robustly
                    button.textContent = 'Ask AI';
                }
            });
        });
    });
</script>

<!-- <<< END OF PASTE BLOCK >>> -->

</body>
</html>
</body>
</html>